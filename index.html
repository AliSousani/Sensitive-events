<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Firestore</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Firestore</h1>
  <button id="pingBtn">Ping Firestore</button>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
    // ---------- 1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase ----------
    const firebaseConfig = {
      apiKey: "Ø§ÛŒÙ†Ø¬Ø§ API Key Ø®ÙˆØ¯Øª Ø±Ùˆ Ø¨Ú¯Ø°Ø§Ø±",
      authDomain: "Ø§ÛŒÙ†Ø¬Ø§ AuthDomain Ø®ÙˆØ¯Øª Ø±Ùˆ Ø¨Ú¯Ø°Ø§Ø±",
      projectId: "Ø§ÛŒÙ†Ø¬Ø§ Project ID Ø®ÙˆØ¯Øª Ø±Ùˆ Ø¨Ú¯Ø°Ø§Ø±",
    };

    // ---------- 2. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ----------
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);
    const col = db.collection("testCollection");

    // ---------- 3. ØªØ§Ø¨Ø¹ Ù¾ÛŒÙ†Ú¯ ----------
    async function pingFirestore() {
      const now = new Date();
      try {
        // Ø§ÙØ²ÙˆØ¯Ù† Ø±Ú©ÙˆØ±Ø¯
        const addRes = await col.add({
          ts: firebase.firestore.FieldValue.serverTimestamp(),
          clientTime: now.toISOString(),
          note: "hello-from-ping"
        });
        console.log("âœ… Ø±Ú©ÙˆØ±Ø¯ Ø«Ø¨Øª Ø´Ø¯. id:", addRes.id);

        // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§
        const qSnap = await col.orderBy("ts", "desc").limit(3).get();
        console.log("ğŸ“„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±:", qSnap.size);
        qSnap.forEach(doc => {
          console.log(doc.id, "=>", doc.data());
        });

      } catch (err) {
        console.error("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„:", err.message);
      }
    }

    document.getElementById("pingBtn").addEventListener("click", pingFirestore);
  </script>
</body>
</html>
